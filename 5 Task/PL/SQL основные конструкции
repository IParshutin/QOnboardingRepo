-----------------------------------------------
---------------Package TEST_QB-----------------
-----------------------------------------------
create or replace package TEST_QB is
   FUNCTION  chk_to_number RETURN number;
end TEST_QB;
-----------------------------------------------
---------------Package body--------------------
-----------------------------------------------
create or replace package body TEST_QB is
  FUNCTION chk_to_number RETURN NUMBER
  IS     
    v_result NUMBER;
    v_total_count_test INTEGER :=0 ; 
    v_succ_count_test INTEGER :=0 ;     
    TYPE varchar_t IS VARRAY(8) OF VARCHAR2(4000);
    TYPE number_t IS VARRAY(8) OF NUMBER;          
    v_test_in varchar_t := varchar_t('100', '100.10', '100.10', '-100123123123123.10','жопа','100,10', '100.10', NULL);
    v_test_out number_t := number_t(100, 100.10, 100.10, -100123123123123.10, 100.10, 100.10, 100.10, NULL);
    v_test_error varchar_t := varchar_t(NULL, NULL, NULL, NULL, '-6502', NULL, NULL, NULL); 
    v_return_result number;
  BEGIN      
    v_total_count_test := v_test_in.count; 
    FOR i in 1..v_total_count_test LOOP
       DECLARE 
         v_error_code NUMBER;
       BEGIN
         dbms_output.put_line('Тест №'|| i ||', Входящая строка: '||v_test_in(i)||'; Ожидаемый результат: '||v_test_out(i));
         v_result := XX_TO_NUMBER(v_test_in(i));
         -- v_result := TO_NUMBER(v_test_in(i));
         IF v_result = v_test_out(i) OR (v_result IS NULL AND v_test_out(i) IS NULL) THEN 
            v_succ_count_test := v_succ_count_test + 1;
            dbms_output.put_line('Тест №'|| i ||' -  Пройден успешно!');
            dbms_output.put_line('--------------------------------------------------------------------------------------------------');
         ELSE
            dbms_output.put_line('------------------------------------------------------------------------------------------------');
            dbms_output.put_line('Ошибка! Тест номер:'|| i);
            dbms_output.put_line('------------------------------------------------------------------------------------------------');            
         END IF;
        EXCEPTION
           WHEN OTHERS THEN
             v_error_code := SQLCODE;
             IF v_error_code = v_test_error(i) THEN
               v_succ_count_test := v_succ_count_test + 1;
               DBMS_OUTPUT.PUT_LINE('Тест №'|| i ||' - Поймал ожидаемое исключение: ' || v_test_in(i));
               dbms_output.put_line('--------------------------------------------------------------------------------------------------');
             ELSE
               DBMS_OUTPUT.PUT_LINE('Тест №'|| i ||' - Не пройден и завершился с  кодом ошибки: ' || v_error_code  );
               dbms_output.put_line('--------------------------------------------------------------------------------------------------');
             END IF;     
         END;
     END LOOP;
     IF v_succ_count_test = v_total_count_test THEN 
        dbms_output.put_line('HELL YEAAH, S !!!');
        v_return_result:= 1;
     ELSE 
        dbms_output.put_line('durak, ERR');
        v_return_result:= 0;
     END IF;
     return v_return_result;
  END chk_to_number;
end TEST_QB;
-----------------------------------------------
---------------XX_TO_NUMBER--------------------
-----------------------------------------------
CREATE OR REPLACE FUNCTION XX_TO_NUMBER(v_in in VARCHAR2) RETURN NUMBER 
IS      
BEGIN
  RETURN(to_number(REPLACE(v_in,',','.')));
END XX_TO_NUMBER;
-----------------------------------------------
---------------TEST RESULTS--------------------
-----------------------------------------------
Тест №1, Входящая строка: 100; Ожидаемый результат: 100
Тест №1 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №2, Входящая строка: 100.10; Ожидаемый результат: 100.1
Тест №2 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №3, Входящая строка: 100.10; Ожидаемый результат: 100.1
Тест №3 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №4, Входящая строка: -100123123123123.10; Ожидаемый результат: -100123123123123.1
Тест №4 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №5, Входящая строка: жопа; Ожидаемый результат: 100.1
Тест №5 - Поймал ожидаемое исключение: жопа
--------------------------------------------------------------------------------------------------
Тест №6, Входящая строка: 100,10; Ожидаемый результат: 100.1
Тест №6 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №7, Входящая строка: 100.10; Ожидаемый результат: 100.1
Тест №7 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
Тест №8, Входящая строка: ; Ожидаемый результат: 
Тест №8 -  Пройден успешно!
--------------------------------------------------------------------------------------------------
HELL YEAAH, S !!!
